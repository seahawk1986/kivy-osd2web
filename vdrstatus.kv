#:kivy 1.9.0
#:import datetime datetime.datetime
#:import time time
#:import SimpleListAdapter kivy.adapters.simplelistadapter.SimpleListAdapter
#:import Label kivy.uix.label.Label
#:import TimerLabel vdr_status_display.TimerLabel
#:import RecordingLabel vdr_status_display.RecordingLabel

<CenteredBlockLabel@BlockLabel>:
    font_size: self.height - 2
    text_size: self.size
    halign: 'center'
    valign: 'middle'

<CenteredBlockButton@BlockButton>:
    font_size: self.height
    halign: 'center'
    valign: 'middle'

<ScreenChooser@ScreenChooserSpinner>:
    text: 'Screen'
    halign: 'center'
    valign: 'middle'
    values: app.screens.values()
    text_size: self.size
    font_size: '28sp'
    on_text: self.change_screen()

<StatusBar@BoxLayout>:
    orientation: 'horizontal'
    spacing: 5
    #padding: 0, 5, 0, 5

    ScreenChooser:
        size_hint: .2, 1

    Label:
        canvas:
            Color:
                rgba: 0, 1, 0, 0.5
            Rectangle:
                pos: self.pos
                size: self.size
        id: date_label
        size_hint: .6, 1
        text_size: self.size
        font_size: self.height * 0.4
        halign: 'center'
        valign: 'center'
        #max_lines: 1
        #shorten: True
        #shorten_from: 'right'
        text: app.datetime

    BlockLabel:
        text: "[b]REC[/b]"
        font_size: self.height
        markup: True
        color: app.rec_color_active if app.is_recording else app.rec_color_inactive
        size_hint: .2, 1


<TimerLabel>:
    canvas:
        Color:
            rgba: 0, 1, 0, 0.5
        Rectangle:
            pos: self.pos
            size: self.size           
    size_hint: 1, None
    #height: "120sp"
    #size: self.texture_size
    text_size: self.width, None
    font_size: (self.height - 15) / 2
    valign: 'top'
    halign: 'left'
    markup: True
        
<TimerRV>:
    viewclass: 'TimerLabel'
    data: app.timers

    RecycleBoxLayout:
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        padding: 5
        spacing: 10

<RecordingLabel>:
    canvas:
        Color:
            rgba: 0, 1, 0, 0.5
        Rectangle:
            pos: self.pos
            size: self.size           
    #height: sp(140)
    size_hint: 1, None
    #size: self.texture_size
    text_size: self.width, None
    font_size: (self.height - 15) / 2
    valign: 'top'
    halign: 'left'
    markup: True

<RecordingRV>:
    viewclass: 'RecordingLabel'
    data: app.recordings
    halign: 'left'
    RecycleBoxLayout:
        default_size: None, dp(56)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        spacing: 5
        padding: 5
        halign: 'left'

<MenuScreen>:
    BoxLayout:
        orientation: 'horizontal'
        BoxLayout:
            size_hint: .7, 1
            orientation: 'vertical'
            ScreenChooserSpinner:
                name: 'Menu'
                values: app.screens.values()
                text: 'Change Screen'
                size_hint: .2, .1
                on_text: self.change_screen()
            BoxLayout:
                orientation: 'vertical'
                size_hint: 1, .8
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, .1
                Button:
                    id: red
                    text: app.btn_red
                    background_color: 1, .1, .1, 1
                Button:
                    id: green
                    text: app.btn_green
                    background_color: .1, 1, .1, 1
                Button:
                    id: yellow
                    text: app.btn_yellow
                    background_color: 1, 1, .1, 1
                Button:
                    id: blue
                    text: app.btn_blue
                    background_color: .1, .1, 1, 1
        GridLayout:
            size_hint: .3, 1
            cols: 3
            rows: 10
            spacing: 5
            Button:
                text: 'Chan+'
            Button:
                text: 'Mute'
            Button:
                text: 'Vol+'
            Button:
                text: 'Chan-'
            Button:
                text: 'Up'
            Button:
                text: 'Vol-'
            Button:
                text: 'Left'
            Button:
                text: 'OK'
            Button:
                text: 'Right'
            Button:
                text: 'Back'
            Button:
                text: 'Down'
            Button:
                text: 'Menu'
            Button:
                text: 'Rew.'
            Button:
                text: 'Stop'
            Button:
                text: 'Fwd.'
            Button:
                text: '1'
            Button:
                text: '2'
            Button:
                text: '3'
            Button:
                text: '4'
            Button:
                text: '5'
            Button:
                text: '6'
            Button:
                text: '7'
            Button:
                text: '8'
            Button:
                text: '9'
            Button:
                text: 'User1'
            Button:
                text: '0'
            Button:
                text: 'User2'

<LiveTVScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 5

        StatusBar:
            size_hint: 1, .18

        BoxLayout:
            size_hint: 1, .40
            orientation: 'vertical'
            BlockLabel:
                name: 'title1'
                shorten: True
                shorten_from: 'right'
                size_hint: 1, .25
                text_size: self.size
                font_size: self.height - 1
                text:
                    time.strftime('%H:%M ', time.localtime(app.present_starttime))\
                    + app.present_title
            BlockLabel:
                size_hint: 1, .15
                shorten: True
                shorten_from: 'right'
                valign: 'top'
                halign: 'left'
                text_size: self.size
                font_size: self.height - 1
                text: app.present_shorttext
            Label:
                size_hint: 1, .6
                halign: 'left'
                valign: 'top'
                #shorten: True
                shorten_from: 'right'
                text: app.present_description
                text_size: self.size
                font_size: self.height / 6

        ProgressBar:
            size_hint: 1, .02
            max: app.epg_progress_max
            value: app.epg_progress_value

        BoxLayout:
            size_hint: 1, .40
            orientation: 'vertical'
            BlockLabel:
                size_hint: 1, .25
                valign: 'top'
                shorten: True
                shorten_from: 'right'
                text_size: self.size
                font_size: self.height - 1
                text:
                    time.strftime("%H:%M ", time.localtime(app.following_starttime)\
                    ) + app.following_title

            BlockLabel:
                size_hint: 1, .15
                shorten: True
                shorten_from: 'right'
                valign: 'top'
                halign: 'left'
                text_size: self.size
                font_size: self.height - 1
                text: app.following_shorttext
            Label:
                size_hint: 1, .6
                halign: 'left'
                valign: 'top'
                text: app.following_description
                text_size: self.size
                font_size: self.height / 6

<ReplayScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 5

        StatusBar:
            size_hint: 1, .18

        CenteredBlockLabel:
            valign: 'top'
            shorten: True
            shorten_from: 'right'
            text_size: self.size
            font_size: self.height
            size_hint: 1, .1
            text: app.replay_name

        CenteredBlockLabel:
            size_hint: 1, .07
            text: app.replay_event_shorttext

        ProgressBar:
            size_hint: 1, .01
            max: app.replaycontrol_total
            value: app.replaycontrol_current

        Label:
            text: app.replay_event_description
            size_hint: 1, .5
            halign: 'left'
            valign: 'top'
            text_size: self.size
            font_size: self.height / 10



<TimerScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 5

        StatusBar:
            size_hint: 1, .18

        TimerRV:
            size_hint: 1, .8

<RecordingsScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 5

        StatusBar:
            size_hint: 1, .18

        RecordingRV:
            size_hint: 1, .8

<ClockScreen>:
    BoxLayout:
        orientation: 'vertical'
        spacing: 5

        StatusBar:
            size_hint: 1, .18

        CenteredBlockLabel:
            id: time
            font_size: '480sp'
            size_hint: 1, .6
            text: app.now

        CenteredBlockLabel:
            text: app.channel_channelname
            shorten: True
            shorten_from: 'right'
            text_size: self.width -10, None
            size_hint: 1, .1

        CenteredBlockLabel:
            size_hint: 1, .1
            text_size: self.width -10, None
            shorten: True
            shorten_from: 'right'
            text: app.present_title

        ProgressBar:
            max:
                app.epg_progress_max\
                if not app.replaycontrol_active else app.replaycontrol_total
            value:
                app.epg_progress_value if not app.replaycontrol_active\
                else app.replaycontrol_current
            size_hint: 1, .01

        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            size_hint: 1, .1

            CenteredBlockLabel:
                text: datetime.fromtimestamp(app.present_starttime).strftime("%H:%M")
                size_hint: .2, 1

            CenteredBlockLabel:
                id: playstatus
                text: "" # Pause" if (app.replaycontrol_active and not app.replaycontrol_play) else "Playing"
                shorten: True
                shorten_from: 'right'
                text_size: self.width -10, None
                size_hint: .6, 1

            CenteredBlockLabel:
                text: datetime.fromtimestamp(app.present_endtime).strftime("%H:%M")
                size_hint: .2, 1
